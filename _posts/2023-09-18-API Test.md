---
layout: post
---

<table id="dataTable_howtomakeaturn">
  <thead>
    <tr>
      <th colspan="3">CodeLove-站長阿川-最新文章</th>
    </tr>
  </thead>
  <tbody>
  <tr>
    <td>日期</td>
    <td>標題</td>
    <td>連結</td>
  </tr>
  </tbody>
</table>

<input type="button" id="btnMore" value="Read more...">

<script>
  let api_howtomakeaturn = {
    url: "https://codelove.tw/api/posts?username=howtomakeaturn&per_page=5&page=",
    pageCount: 1,
    table: document.getElementById("dataTable_howtomakeaturn"),
    btn: document.getElementById("btnMore_howtomakeaturn"),
    call: function(){
      let tmpURL = api_howtomakeaturn.url + api_howtomakeaturn.pageCount;
      let tmpTable = api_howtomakeaturn.table;
      callAPI(tmpURL, tmpTable);
      api_howtomakeaturn.pageCount += 1;
    }
  };

  api_howtomakeaturn.call();
  
  api_howtomakeaturn.btn.onclick = function () {
      api_howtomakeaturn.call();
  };
  
  function callAPI(url, table){
    fetch(url)
      .then((res) => {
        const data = res.json();
        return data;
      })
      .then((data) => {
        console.log(data);
        if(data.length == 0){
          alert('沒有更多文章了!');          
          return;
        }
        for (let i = 0; i < data.length; i++) {
          let dr = document.createElement("TR");
    
          let dc_date = document.createElement("TD");
          let postDate = new Date(data[i]['published_at']);
          let year = postDate.getFullYear();
          let month = postDate.getMonth();
          let day = postDate.getDate();
          let formatDate = `${year}-${month}-${day}`;
          let txt = document.createTextNode(formatDate);
          dc_date.appendChild(txt);
          dc_date.style.width = '20%';
          dr.appendChild(dc_date);
          
          let dc_title = document.createElement("TD");
          txt = document.createTextNode(data[i]['title']);
          dc_title.appendChild(txt);
          dr.appendChild(dc_title);
    
          let dc_url = document.createElement("TD");
          let url = document.createElement("a");
          url.href = data[i]['canonical_url'];
          url.innerHTML = data[i]['id'];
          url.target="_blank";
          dc_url.appendChild(url);
          dr.appendChild(dc_url);
          
          table.appendChild(dr);
        }
      });
  }
</script>
