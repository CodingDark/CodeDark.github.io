---
layout: post
title: CodeLove-文章列表(API)
categories: program
---

{% highlight ruby %}
def print_hi(name)
  puts "Hi, #{name}"
end
print_hi('Tom')
#=> prints 'Hi, Tom' to STDOUT.
{% endhighlight %}


<table id="dataTable_howtomakeaturn">
  <thead>
    <tr>
      <th colspan="3">CodeLove-站長阿川-最新文章</th>
    </tr>
  </thead>
  <tbody>
  <tr>
    <td width="20%">日期</td>
    <td>標題</td>
    <td width="10%">連結</td>
  </tr>
  </tbody>
</table>

<input type="button" id="btnMore_howtomakeaturn" value="Read more...">

<br>

<table id="dataTable_hung19091">
  <thead>
    <tr>
      <th colspan="3">CodeLove-大塚宏-最新文章</th>
    </tr>
  </thead>
  <tbody>
  <tr>
    <td width="20%">日期</td>
    <td>標題</td>
    <td width="10%">連結</td>
  </tr>
  </tbody>
</table>

<input type="button" id="btnMore_hung19091" value="Read more...">

<script>
  let api = new Array();
  
  api[0] = setAPI("howtomakeaturn");
  api[1] = setAPI("hung19091");
  
  for(let i = 0;i < api.length;i++){
    api[i].call();
    api[i].btn.onclick = function () {
        api[i].call();
    };
  }
  
  function setAPI(user){    
    let obj = {
      url: "https://codelove.tw/api/posts?username=" + user + "&per_page=5&page=",
      pageCount: 1,
      table: document.getElementById("dataTable_" + user),
      btn: document.getElementById("btnMore_" + user),
      call: function(){
        let tmpURL = this.url + this.pageCount;
        let tmpTable = this.table;
        callAPI(tmpURL, tmpTable);
        this.pageCount += 1;
      }
    };
    
    return obj;
  }
  
  function callAPI(url, table){
    fetch(url)
      .then((res) => {
        const data = res.json();
        return data;
      })
      .then((data) => {
        //console.log(data);
        if(data.length == 0){
          alert('沒有更多文章了!');          
          return;
        }
        for (let i = 0; i < data.length; i++) {
          let dr = document.createElement("TR");
    
          let dc_date = document.createElement("TD");
          let postDate = new Date(data[i]['published_at']);
          let year = postDate.getFullYear();
          let month = postDate.getMonth();
          let day = postDate.getDate();
          let formatDate = `${year}-${month}-${day}`;
          let txt = document.createTextNode(formatDate);
          dc_date.appendChild(txt);
          //dc_date.style.width = '20%';
          dr.appendChild(dc_date);
          
          let dc_title = document.createElement("TD");
          txt = document.createTextNode(data[i]['title']);
          dc_title.appendChild(txt);
          dr.appendChild(dc_title);
    
          let dc_url = document.createElement("TD");
          let url = document.createElement("a");
          url.href = data[i]['canonical_url'];
          url.innerHTML = data[i]['id'];
          url.target = "_blank";
          url.rel = "noopenner";
          dc_url.appendChild(url);
          dr.appendChild(dc_url);
          
          table.appendChild(dr);
        }
      });
  }
</script>
